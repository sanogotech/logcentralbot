<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Centralisateur de Logs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- DataTables CSS Bootstrap 5 -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body class="bg-light text-dark">

    <div class="container py-4">
        <h1 class="mb-4 text-primary text-center">üìä Centralisateur de Logs</h1>

        <!-- Zone de Filtres -->
        <form method="get" class="row g-3 align-items-end mb-4">
            <div class="col-md-4">
                <label for="tag" class="form-label">Filtrer par Tag</label>
                <input type="text" id="tag" name="tag" class="form-control" placeholder="ex: auth, api, db" value="{{ tag_filter or '' }}" />
            </div>
            <div class="col-md-4">
                <label for="level" class="form-label">Niveau</label>
                <select name="level" id="level" class="form-select">
                    <option value="">Tous les niveaux</option>
                    <option value="INFO" {% if level_filter == 'INFO' %}selected{% endif %}>INFO</option>
                    <option value="WARNING" {% if level_filter == 'WARNING' %}selected{% endif %}>WARNING</option>
                    <option value="ERROR" {% if level_filter == 'ERROR' %}selected{% endif %}>ERROR</option>
                </select>
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary w-100" type="submit">üîç Appliquer les Filtres</button>
            </div>
        </form>

        <!-- R√©sum√© des Filtres -->
        <div class="alert alert-info">
            <strong>Filtres actifs :</strong>
            Tag = <span class="badge bg-secondary">{{ tag_filter or 'Tous' }}</span>,
            Niveau = <span class="badge bg-secondary">{{ level_filter or 'Tous' }}</span>,
            R√©sultats : <span class="badge bg-dark">{{ logs|length }}</span>
        </div>

        <!-- Tableau de Logs avec DataTables -->
        <div class="table-responsive">
            <table id="logsTable" class="table table-hover table-striped table-bordered align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>üè∑Ô∏è Tag</th>
                        <th>üïí Date/Heure</th>
                        <th>‚ö†Ô∏è Niveau</th>
                        <th>üìù Message</th>
                    </tr>
                </thead>
                <tbody>
                    {% if logs %}
                        {% for log in logs %}
                        <tr>
                            <td>{{ log.tag or '-' }}</td>
                            <td>{{ log.timestamp or '-' }}</td>
                            <td>
                                <span class="badge 
                                    {% if log.level == 'ERROR' %}bg-danger
                                    {% elif log.level == 'WARNING' %}bg-warning text-dark
                                    {% elif log.level == 'INFO' %}bg-info text-dark
                                    {% else %}bg-secondary{% endif %}">
                                    {{ log.level or 'N/A' }}
                                </span>
                            </td>
                            <td>{{ log.message or '-' }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">Aucun log ne correspond √† vos crit√®res.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Aide -->
        <div class="alert alert-secondary mt-4">
            <h5>‚ÑπÔ∏è Astuces :</h5>
            <ul>
                <li>Utilisez des mots-cl√©s dans le champ <strong>Tag</strong> pour cibler une source sp√©cifique.</li>
                <li>Combinez le filtre <strong>Niveau</strong> pour n'afficher que les erreurs critiques.</li>
                <li>Les couleurs indiquent visuellement le niveau de gravit√© : 
                    <span class="badge bg-info text-dark">INFO</span>, 
                    <span class="badge bg-warning text-dark">WARNING</span>, 
                    <span class="badge bg-danger">ERROR</span>.
                </li>
            </ul>
        </div>

        <footer class="text-center text-muted mt-5 small">
            Centralisateur de Logs - Flask App &copy; 2025
        </footer>
    </div>

    <!-- jQuery, Bootstrap JS, DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <!-- Activation DataTables -->
    <script>
        $(document).ready(function () {
            $('#logsTable').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json'
                },
                order: [[1, 'desc']], // Tri par date d√©croissante
                pageLength: 10,
                lengthMenu: [5, 10, 25, 50, 100]
            });
        });
    </script>
</body>
</html>
